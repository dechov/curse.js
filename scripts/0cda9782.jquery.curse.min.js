$.fn.curse=function(a){var b=$.extend({scrollMarginRatio:1/7,cursorSize:10,color:"#AAAAAA",animateSpeed:300,markPageNumbers:!1},a);return this.each(function(){var a=$(this);b.height&&a.height(b.height),a.css("overflow","hidden"),"absolute"!==a.css("position")&&a.css("position","relative");var c=b.initialScrollPosition;void 0===c&&(c=a.scrollTop()),a.data("scrollPosition",c),a.data("maxScrollPosition",a.prop("scrollHeight")),$('<div class="cursejs-cursor">').css({position:"absolute",left:0,"z-index":1e3,width:0,height:0,"border-bottom":"0 solid transparent","border-top":"0 solid transparent","border-left-style":"solid","border-left-color":b.color,"border-width":b.cursorSize,"font-size":0,"line-height":0}).appendTo(a),$('<div class="cursejs-margin cursejs-top-margin">').css({opacity:0,background:"linear-gradient(to bottom, "+a.css("backgroundColor")+" 0%, hsla(0,0%,100%,0) 100%)"}).appendTo(a),$('<div class="cursejs-margin cursejs-bottom-margin">').css({background:"linear-gradient(to bottom, hsla(0,0%,100%,0) 0%, "+a.css("backgroundColor")+" 100%)"}).appendTo(a),$(".cursejs-margin").css({position:"absolute",left:0,right:0,"border-width":0,"border-color":a.css("backgroundColor"),"border-style":"solid","pointer-events":"none"});var d=function(b,c,d,e,f){a.find(".cursejs-top-margin").stop().animate({top:d*c-1-c-b,opacity:0===d?0:1},f),a.find(".cursejs-bottom-margin").stop().animate({top:d*c-1+b+c,opacity:d===e?0:1},f)};a.bind("mousewheel",function(c,e,f,g){g=g||0;var h=a.data("scrollMargin"),i=a.data("scrollInterval"),j=a.data("maxPageIndex"),k=a.data("maxScrollPosition"),l=Math.max(0,Math.min(k,a.data("scrollPosition")-g/4)),m=Math.max(0,Math.min(j,Math.floor((l-h)/i))),n=l-i*m;return m!==a.data("pageIndex")&&(a.stop().animate({scrollTop:m*i},b.animateSpeed),d(h,i,m,j,b.animateSpeed)),a.find("div.cursejs-cursor").css("top",l-Math.ceil(b.cursorSize)),a.data("scrollPosition",l),a.data("pageIndex",m),a.data("scrollOffset",n),!1}),a.bind("resize",function(){var a=$(this),c=a.scrollTop();a.find(".cursejs-bottom-margin, .cursejs-cursor").hide();var e=a.prop("scrollHeight");a.find(".cursejs-bottom-margin, .cursejs-cursor").show(),a.scrollTop(c);var f=a.outerHeight()*b.scrollMarginRatio,g=a.outerHeight()-2*f,h=Math.floor((e-2*f)/g),i=a.data("scrollPosition")/a.data("maxScrollPosition")*e,j=Math.max(0,Math.min(h,Math.floor((i-f)/g)));if(console.log(a.data("scrollPosition"),a.data("maxScrollPosition"),e),b.markPageNumbers){a.find(".cursejs-pagenum").remove();var k;for(k=1;h>=k;k++){var l=k+1;$('<div class="cursejs-pagenum">').html(l).css({position:"absolute",left:"0.4em","font-size":"0.6em",color:b.color,"font-family":"Sans-Serif",top:f+k*g}).appendTo(a)}}a.stop().animate({scrollTop:j*g},b.animateSpeed),a.find(".cursejs-margin").css({height:2*f+g}),a.find(".cursejs-top-margin").css({"border-top-width":f+g}),a.find(".cursejs-bottom-margin").css({"border-bottom-width":f+g}),d(f,g,j,h,b.animateSpeed),a.data("scrollMargin",f),a.data("scrollInterval",g),a.data("pageIndex",j),a.data("maxPageIndex",h),a.data("scrollPosition",i),a.data("maxScrollPosition",e),a.trigger("mousewheel")}),a.trigger("resize")})};